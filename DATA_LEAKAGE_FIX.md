# Data Leakage Fix & Drawdown Protection

## üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞: Data Leakage (–ò–°–ü–†–ê–í–õ–ï–ù–ê)

### –ß—Ç–æ –±—ã–ª–æ –Ω–∞–π–¥–µ–Ω–æ

**–ü—Ä–æ–±–ª–µ–º–∞ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –≤ –∫–ª–∞—Å—Å–µ `SwingDetector`:**

```python
# ‚ùå –°–¢–ê–†–´–ô –ö–û–î (—Å —É—Ç–µ—á–∫–æ–π –¥–∞–Ω–Ω—ã—Ö):
for i in range(lookback, n - lookback):
    for j in range(1, lookback + 1):
        if df['high'].iloc[i] <= df['high'].iloc[i + j]:  # ‚ö†Ô∏è –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ë–£–î–£–©–ò–ï –¥–∞–Ω–Ω—ã–µ!
            is_swing_high = False
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –ê–ª–≥–æ—Ä–∏—Ç–º –ø—Ä–æ–≤–µ—Ä—è–ª `i + j` (–±—É–¥—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ) –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è swing high/low –≤ —Ç–µ–∫—É—â–∏–π –º–æ–º–µ–Ω—Ç –≤—Ä–µ–º–µ–Ω–∏ `i`. –≠—Ç–æ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π **look-ahead bias** - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏, –∫–æ—Ç–æ—Ä–∞—è –±—ã–ª–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ –≤ –º–æ–º–µ–Ω—Ç –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏—è.

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- –ó–∞–≤—ã—à–µ–Ω–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –±—ç–∫—Ç–µ—Å—Ç–∏–Ω–≥–∞
- –ù–µ–≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ—Å—Ç—å –Ω–∞ live-—Ç–æ—Ä–≥–æ–≤–ª–µ
- –õ–æ–∂–Ω–æ–µ —á—É–≤—Å—Ç–≤–æ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏

---

### –ö–∞–∫ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

**‚úÖ –ù–û–í–´–ô –ö–û–î (–±–µ–∑ —É—Ç–µ—á–∫–∏):**

```python
# Swing –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ü–û–°–õ–ï –ø–µ—Ä–∏–æ–¥–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
for i in range(lookback * 2, n):
    swing_idx = i - lookback  # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–æ—à–ª–æ–µ
    
    for j in range(1, lookback + 1):
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–ª—å–∫–æ –ø—Ä–æ—à–ª—ã–µ –¥–∞–Ω–Ω—ã–µ
        if df['high'].iloc[swing_idx] <= df['high'].iloc[swing_idx - j]:
            is_swing_high = False
        # –ü–µ—Ä–∏–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è (—É–∂–µ –≤ –ø—Ä–æ—à–ª–æ–º)
        if df['high'].iloc[swing_idx] <= df['high'].iloc[swing_idx + j]:
            is_swing_high = False
```

**–ö–ª—é—á–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:**

1. **–ó–∞–¥–µ—Ä–∂–∫–∞ —Å–∏–≥–Ω–∞–ª–∞:** Swing high/low –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π –≤ `lookback` –±–∞—Ä–æ–≤
2. **–¢–æ–ª—å–∫–æ –ø—Ä–æ—à–ª—ã–µ –¥–∞–Ω–Ω—ã–µ:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, –¥–æ—Å—Ç—É–ø–Ω–∞—è –¥–æ –º–æ–º–µ–Ω—Ç–∞ –≤—Ä–µ–º–µ–Ω–∏ `i`
3. **–ü–µ—Ä–∏–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è:** "–ë—É–¥—É—â–∏–µ" –¥–∞–Ω–Ω—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è, –Ω–æ —Å–∏–≥–Ω–∞–ª –ø–æ—è–≤–ª—è–µ—Ç—Å—è –ø–æ–∑–∂–µ

**–ü—Ä–∏–º–µ—Ä:**
```
Lookback = 5

–ë–∞—Ä 10: –í–æ–∑–º–æ–∂–Ω—ã–π swing high
–ë–∞—Ä 11-15: –ü–µ—Ä–∏–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
–ë–∞—Ä 15: –°–∏–≥–Ω–∞–ª swing high –ø–æ—è–≤–ª—è–µ—Ç—Å—è (–µ—Å–ª–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω)

–í –º–æ–º–µ–Ω—Ç –±–∞—Ä–∞ 15 –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–ª—å–∫–æ –¥–∞–Ω–Ω—ã–µ –±–∞—Ä–æ–≤ 0-15.
```

---

## üìä –í–ª–∏—è–Ω–∏–µ –Ω–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –û–∂–∏–¥–∞–µ–º—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:

| –ú–µ—Ç—Ä–∏–∫–∞ | –ë—ã–ª–æ (—Å —É—Ç–µ—á–∫–æ–π) | –û–∂–∏–¥–∞–µ—Ç—Å—è (–±–µ–∑ —É—Ç–µ—á–∫–∏) |
|---------|------------------|------------------------|
| Win Rate | –ó–∞–≤—ã—à–µ–Ω | –°–Ω–∏–∑–∏—Ç—Å—è –Ω–∞ 5-10% |
| Profit Factor | –ó–∞–≤—ã—à–µ–Ω | –°–Ω–∏–∑–∏—Ç—Å—è –Ω–∞ 10-20% |
| Total Return | –ó–∞–≤—ã—à–µ–Ω | –°–Ω–∏–∑–∏—Ç—Å—è |
| Timing | –ò–¥–µ–∞–ª—å–Ω—ã–π | –†–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π |
| Live Performance | –ù–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç | –°–æ–≤–ø–∞–¥–∞–µ—Ç |

**–≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ!** –ß–µ—Å—Ç–Ω—ã–π –±—ç–∫—Ç–µ—Å—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã.

---

## üõ°Ô∏è Drawdown Protection (–ù–û–í–ê–Ø –§–£–ù–ö–¶–ò–Ø)

### –û–ø–∏—Å–∞–Ω–∏–µ

–î–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞—â–∏—Ç–∞ –æ—Ç —á—Ä–µ–∑–º–µ—Ä–Ω—ã—Ö –ø—Ä–æ—Å–∞–¥–æ–∫:
- –¢–æ—Ä–≥–æ–≤–ª—è –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞ drawdown
- –¢–æ—Ä–≥–æ–≤–ª—è –≤–æ–∑–æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ –Ω–∞ 50% –æ—Ç –ª–∏–º–∏—Ç–∞
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç—Å—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö —Å–¥–µ–ª–æ–∫

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

**1. –í–∫–ª—é—á–∏—Ç—å –≤ `config.py`:**

```python
# –ë–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
MAX_DRAWDOWN_LIMIT = None

# –° –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º 20%
MAX_DRAWDOWN_LIMIT = 0.20

# –° –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º 15%
MAX_DRAWDOWN_LIMIT = 0.15
```

**2. –ó–∞–ø—É—Å—Ç–∏—Ç—å –±—ç–∫—Ç–µ—Å—Ç:**

```bash
python smart_money.py
```

**3. –†–µ–∑—É–ª—å—Ç–∞—Ç:**

```
‚ö†Ô∏è  Drawdown protection enabled: Max 20%

Running backtest...

‚ö†Ô∏è  Drawdown Protection Stats:
   Trades skipped due to drawdown limit: 245
```

---

## üî¨ Drawdown Optimizer (–ù–û–í–´–ô –ò–ù–°–¢–†–£–ú–ï–ù–¢)

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏—é —Å —Ä–∞–∑–Ω—ã–º–∏ –ª–∏–º–∏—Ç–∞–º–∏ drawdown, —á—Ç–æ–±—ã –Ω–∞–π—Ç–∏ –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å.

### –ó–∞–ø—É—Å–∫

```bash
python drawdown_optimizer.py
```

### –ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è —Å–ª–µ–¥—É—é—â–∏–µ –ª–∏–º–∏—Ç—ã:
- **None** - –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è (baseline)
- **50%** - –æ—á–µ–Ω—å —Å–≤–æ–±–æ–¥–Ω–æ
- **40%** - —Å–≤–æ–±–æ–¥–Ω–æ
- **30%** - —É–º–µ—Ä–µ–Ω–Ω–æ
- **20%** - —Å—Ç—Ä–æ–≥–æ
- **15%** - –æ—á–µ–Ω—å —Å—Ç—Ä–æ–≥–æ
- **10%** - —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω–æ —Å—Ç—Ä–æ–≥–æ

### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

**1. CSV —Ñ–∞–π–ª:** `drawdown_optimization_results.csv`

```csv
drawdown_limit,total_trades,win_rate,profit_factor,total_return,max_drawdown,sharpe_ratio,trades_skipped
None,3009,70.79,4.83,22743821746.20,-90.93,6.69,0
0.50,2856,71.24,4.91,15234567890.12,-49.87,7.12,153
0.40,2701,72.11,5.03,12345678901.23,-39.45,7.45,308
...
```

**2. –ì—Ä–∞—Ñ–∏–∫:** `drawdown_optimization_results.png`

9 –≥—Ä–∞—Ñ–∏–∫–æ–≤ –ø–æ–∫–∞–∑—ã–≤–∞—é—â–∏—Ö:
- Total Return vs DD Limit
- Sharpe Ratio vs DD Limit
- Max Drawdown vs DD Limit
- Total Trades vs DD Limit
- Trades Skipped vs DD Limit
- Win Rate vs DD Limit
- Profit Factor vs DD Limit
- Avg Trade P&L vs DD Limit
- Summary Table (–ª—É—á—à–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏)

**3. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –≤ –∫–æ–Ω—Å–æ–ª–∏:**

```
Recommendation:
  Recommended Drawdown Limit: 20%
  Expected Sharpe Ratio: 7.45
  Expected Return: 12345.67%
  Max Drawdown: -19.89%

  To use this limit, set in config.py:
  MAX_DRAWDOWN_LIMIT = 0.20
```

---

## üìã –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### –ß—Ç–æ –∏—Å–∫–∞—Ç—å:

**1. Best Sharpe Ratio**
- –õ—É—á—à–∏–π —Ä–∏—Å–∫-adjusted returns
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞

**2. Best Return**
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–∏–±—ã–ª—å
- –ú–æ–∂–µ—Ç –±—ã—Ç—å —Å –≤—ã—Å–æ–∫–∏–º —Ä–∏—Å–∫–æ–º

**3. Best DD Control**
- –õ—É—á—à–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å –ø—Ä–æ—Å–∞–¥–∫–∏
- –î–ª—è –∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã—Ö —Ç—Ä–µ–π–¥–µ—Ä–æ–≤

### –¢–∏–ø–∏—á–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã:

**–°—Ç—Ä–æ–≥–∏–π –ª–∏–º–∏—Ç (10-15%):**
- ‚úÖ –ú–∞–ª–∞—è –ø—Ä–æ—Å–∞–¥–∫–∞
- ‚úÖ –ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –∫–æ–º—Ñ–æ—Ä—Ç
- ‚ùå –ú–µ–Ω—å—à–µ —Å–¥–µ–ª–æ–∫
- ‚ùå –ú–µ–Ω—å—à–µ –ø—Ä–∏–±—ã–ª—å

**–£–º–µ—Ä–µ–Ω–Ω—ã–π –ª–∏–º–∏—Ç (20-30%):**
- ‚úÖ –ë–∞–ª–∞–Ω—Å —Ä–∏—Å–∫/–ø—Ä–∏–±—ã–ª—å
- ‚úÖ –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å–¥–µ–ª–æ–∫
- ‚ö†Ô∏è –£–º–µ—Ä–µ–Ω–Ω–∞—è –ø—Ä–æ—Å–∞–¥–∫–∞

**–°–≤–æ–±–æ–¥–Ω—ã–π –ª–∏–º–∏—Ç (40-50%):**
- ‚úÖ –ú–∞–∫—Å–∏–º—É–º —Å–¥–µ–ª–æ–∫
- ‚úÖ –ú–∞–∫—Å–∏–º—É–º –ø—Ä–∏–±—ã–ª—å
- ‚ùå –í—ã—Å–æ–∫–∞—è –ø—Ä–æ—Å–∞–¥–∫–∞
- ‚ùå –°—Ç—Ä–µ—Å—Å

**–ë–µ–∑ –ª–∏–º–∏—Ç–∞:**
- ‚úÖ Baseline –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
- ‚ùå –ú–æ–∂–µ—Ç –±—ã—Ç—å —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω–∞—è –ø—Ä–æ—Å–∞–¥–∫–∞

---

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏:

```python
# config.py
MAX_DRAWDOWN_LIMIT = None  # –°–Ω–∞—á–∞–ª–∞ –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π
```

–ó–∞–ø—É—Å—Ç–∏—Ç–µ:
```bash
python smart_money.py  # Baseline
python drawdown_optimizer.py  # –ù–∞–π—Ç–∏ –æ–ø—Ç–∏–º—É–º
```

### –î–ª—è demo-—Ç–æ—Ä–≥–æ–≤–ª–∏:

```python
# config.py
MAX_DRAWDOWN_LIMIT = 0.20  # 20% –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
```

### –î–ª—è live-—Ç–æ—Ä–≥–æ–≤–ª–∏:

```python
# config.py
MAX_DRAWDOWN_LIMIT = 0.15  # –ö–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω–æ –¥–ª—è live
```

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### 1. Data Leakage - —Ç–µ–ø–µ—Ä—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω

‚úÖ –°–∏—Å—Ç–µ–º–∞ —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¢–û–õ–¨–ö–û –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ
‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –±—ç–∫—Ç–µ—Å—Ç–∞ —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã
‚úÖ –ú–æ–∂–Ω–æ –¥–æ–≤–µ—Ä—è—Ç—å –º–µ—Ç—Ä–∏–∫–∞–º

### 2. Drawdown Protection - –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞

- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–ª—è –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–≥–æ –∫–æ–º—Ñ–æ—Ä—Ç–∞
- –ú–æ–∂–µ—Ç —Å–Ω–∏–∑–∏—Ç—å –ø—Ä–∏–±—ã–ª—å, –Ω–æ –∑–∞—â–∏—â–∞–µ—Ç –∫–∞–ø–∏—Ç–∞–ª
- –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞ –¥–ª—è live-—Ç–æ—Ä–≥–æ–≤–ª–∏

### 3. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è - —Ä–µ–≥—É–ª—è—Ä–Ω–∞—è

- –ü—Ä–æ–≤–æ–¥–∏—Ç–µ –∫–∞–∂–¥—ã–µ 3-6 –º–µ—Å—è—Ü–µ–≤
- –†—ã–Ω–æ–∫ –º–µ–Ω—è–µ—Ç—Å—è ‚Üí –æ–ø—Ç–∏–º—É–º –º–µ–Ω—è–µ—Ç—Å—è
- –ù–µ –ø–µ—Ä–µ–æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–π—Ç–µ (overfitting)

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ê–ª–≥–æ—Ä–∏—Ç–º Drawdown Protection:

```python
peak_equity = initial_capital

for each bar:
    # Update peak
    if current_equity > peak_equity:
        peak_equity = current_equity
    
    # Calculate drawdown
    drawdown = (current_equity - peak_equity) / peak_equity
    
    # Check limit
    if drawdown <= -max_drawdown_limit:
        stop_trading = True
    
    # Resume condition
    if drawdown >= -(max_drawdown_limit * 0.5):
        stop_trading = False
    
    # Skip new trades if stopped
    if stop_trading and new_signal:
        skip_trade()
```

### –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ:

–¢–æ—Ä–≥–æ–≤–ª—è –≤–æ–∑–æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ –Ω–∞ **50% –æ—Ç –ª–∏–º–∏—Ç–∞**:

- –õ–∏–º–∏—Ç 20% ‚Üí —Å—Ç–æ–ø –ø—Ä–∏ -20% ‚Üí –≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ -10%
- –õ–∏–º–∏—Ç 30% ‚Üí —Å—Ç–æ–ø –ø—Ä–∏ -30% ‚Üí –≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ -15%

–≠—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç —á–∞—Å—Ç–æ–µ –≤–∫–ª/–≤—ã–∫–ª —Ç–æ—Ä–≥–æ–≤–ª–∏.

---

## üìä –ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞

### smart_money.py —Å drawdown protection:

```
============================================================
 SMART MONEY CONCEPTS (SMC) BACKTESTING SYSTEM
============================================================

Loading data from data/BTCUSDT_1m_binance.csv...
Loaded 3,096,812 rows from 2020-01-01 to 2025-11-22

‚ö†Ô∏è  Drawdown protection enabled: Max 20%

Running backtest...

‚ö†Ô∏è  Drawdown Protection Stats:
   Trades skipped due to drawdown limit: 187

============================================================
 SMART MONEY CONCEPTS - BACKTEST RESULTS
============================================================

TRADE STATISTICS
------------------------------------------------------------
Total Trades:           2822  (–±—ã–ª–æ 3009)
Win Rate:               71.24%  (–±—ã–ª–æ 70.79%)
Profit Factor:          4.91  (–±—ã–ª–æ 4.83)

RETURNS & RISK
------------------------------------------------------------
Total Return:           15,234.56%
Max Drawdown:           -19.87%  (–±—ã–ª–æ -90.93%) ‚úÖ
Sharpe Ratio:           7.45  (–±—ã–ª–æ 6.69) ‚úÖ
```

### drawdown_optimizer.py:

```
============================================================
 DRAWDOWN LIMIT OPTIMIZATION
============================================================

Testing 7 different drawdown limits...

[1/7] Testing Drawdown Limit: No Limit
   Total Trades: 3009
   Trades Skipped: 0
   Max Drawdown: -90.93%
   Sharpe Ratio: 6.69

[2/7] Testing Drawdown Limit: 50%
   Total Trades: 2856
   Trades Skipped: 153
   Max Drawdown: -49.87%
   Sharpe Ratio: 7.12

[3/7] Testing Drawdown Limit: 20%
   Total Trades: 2822
   Trades Skipped: 187
   Max Drawdown: -19.87%
   Sharpe Ratio: 7.45 ‚≠ê

...

üèÜ BEST PERFORMERS:
   Best Sharpe: 7.45 at DD Limit 20%

Recommendation:
  Recommended Drawdown Limit: 20%
  To use this limit, set in config.py:
  MAX_DRAWDOWN_LIMIT = 0.20
```

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏

- [ ] –ü–æ–Ω–∏–º–∞—é —á—Ç–æ —Ç–∞–∫–æ–µ data leakage
- [ ] –ü–æ–Ω–∏–º–∞—é –ø–æ—á–µ–º—É —Å—Ç–∞—Ä—ã–π –∫–æ–¥ –±—ã–ª –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–º
- [ ] –ü–æ–Ω–∏–º–∞—é –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–æ–≤—ã–π SwingDetector
- [ ] –ó–Ω–∞—é –∫–∞–∫ –≤–∫–ª—é—á–∏—Ç—å drawdown protection
- [ ] –ó–∞–ø—É—Å—Ç–∏–ª drawdown_optimizer.py
- [ ] –í—ã–±—Ä–∞–ª –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –ª–∏–º–∏—Ç drawdown
- [ ] –û–±–Ω–æ–≤–∏–ª config.py
- [ ] –ü–µ—Ä–µ—Å—á–∏—Ç–∞–ª –±—ç–∫—Ç–µ—Å—Ç —Å –Ω–æ–≤—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏

---

## üìû FAQ

**Q: –ù–∞—Å–∫–æ–ª—å–∫–æ –∏–∑–º–µ–Ω—è—Ç—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ—Å–ª–µ fix?**
A: Win rate –º–æ–∂–µ—Ç —Å–Ω–∏–∑–∏—Ç—å—Å—è –Ω–∞ 5-10%, –Ω–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å—Ç–∞–Ω—É—Ç —á–µ—Å—Ç–Ω—ã–º–∏ –∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º—ã–º–∏.

**Q: –ù—É–∂–Ω–æ –ª–∏ –≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å drawdown limit?**
A: –î–ª—è –±—ç–∫—Ç–µ—Å—Ç–∏–Ω–≥–∞ - –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ. –î–ª—è live - –Ω–∞—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è.

**Q: –ö–∞–∫–æ–π –ª–∏–º–∏—Ç drawdown –≤—ã–±—Ä–∞—Ç—å?**
A: –ó–∞–ø—É—Å—Ç–∏—Ç–µ drawdown_optimizer.py –∏ –≤—ã–±–µ—Ä–∏—Ç–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ Sharpe ratio.

**Q: –ú–æ–∂–Ω–æ –ª–∏ –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞—Ç—å —Å –¥—Ä—É–≥–∏–º–∏ —Ñ–∏–ª—å—Ç—Ä–∞–º–∏?**
A: –î–∞! Drawdown protection - —ç—Ç–æ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞—â–∏—Ç–∞, –Ω–µ –∑–∞–º–µ–Ω—è–µ—Ç –¥—Ä—É–≥–∏–µ —Ñ–∏–ª—å—Ç—Ä—ã.

**Q: –í–ª–∏—è–µ—Ç –ª–∏ –Ω–∞ —Å–∫–æ—Ä–æ—Å—Ç—å –±—ç–∫—Ç–µ—Å—Ç–∏–Ω–≥–∞?**
A: –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ. –î–æ–±–∞–≤–ª—è–µ—Ç ~1-2% –∫ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.

---

## üéì –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

**Data Leakage:**
- "Advances in Financial Machine Learning" - Chapter 7
- "Evidence-Based Technical Analysis" - D. Aronson

**Drawdown Management:**
- "Trading Risk" - Kenneth L. Grant
- "Quantitative Trading" - Ernie Chan

**Position Sizing:**
- "The Mathematics of Money Management" - Ralph Vince
- "Trade Your Way to Financial Freedom" - Van K. Tharp

---

**–í–µ—Ä—Å–∏—è:** 1.1.0  
**–î–∞—Ç–∞:** –ù–æ—è–±—Ä—å 2025  
**–°—Ç–∞—Ç—É—Å:** Production Ready ‚úÖ

---

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
- ‚úÖ Data leakage —É—Å—Ç—Ä–∞–Ω—ë–Ω
- ‚úÖ Drawdown protection –¥–æ–±–∞–≤–ª–µ–Ω–∞
- ‚úÖ Optimizer –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞

